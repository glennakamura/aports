# Contributor: Natanael Copa <ncopa@alpinelinux.org>
# Maintainer:
pkgname=gutenprint
pkgver=5.2.14
pkgrel=0
pkgdesc="Printer Drivers Package"
url="http://gimp-print.sourceforge.net/"
arch="all"
license="GPL-2.0-or-later"
depends=""
depends_dev=""
makedepends="$depends_dev cups-dev tiff-dev libjpeg-turbo-dev libpng-dev
	ghostscript-dev libusb-dev autoconf automake libtool gettext-dev"
install=""
subpackages="$pkgname-dev $pkgname-doc $pkgname-lang $pkgname-libs
	$pkgname-cups $pkgname-samples"
source="https://downloads.sourceforge.net/gimp-print/gutenprint-$pkgver.tar.bz2
	musl-fix-header.patch
	pagesize-name-clash.patch
	gutenprint-O6.patch
	"

_builddir="$srcdir"/gutenprint-$pkgver
prepare() {
	local i
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
	mkdir -p m4local
	autoreconf -vif || return 1
}

build() {
	cd "$_builddir"
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--infodir=/usr/share/info \
		--localstatedir=/var \
		--disable-nls \
		--disable-cups-ppds \
		--enable-simplified-cups-ppds \
		|| return 1
	make || return 1
}

package() {
	cd "$_builddir"
	make DESTDIR="$pkgdir" install || return 1
	rm -r "$pkgdir"/usr/share/gutenprint/doc \
		"$pkgdir"/etc/cups/command.types \
		|| return 1
}

cups() {
	pkgdesc="CUPS drivers for Canon, Epson, HP and compatible printers"
	for d in usr/share usr/lib usr/bin usr/sbin etc; do
		mkdir -p "$subpkgdir"/$d || return 1
		mv "$pkgdir"/$d/cups* "$subpkgdir"/$d/ || return 1
	done
}

samples() {
	pkgdesc="Sample test pattern generator for gutenprint-dev"
	mkdir -p "$subpkgdir"/usr/share/gutenprint "$subpkgdir"/usr/bin
	mv "$pkgdir"/usr/share/gutenprint/samples \
		"$subpkgdir"/usr/share/gutenprint/ || return 1
	mv "$pkgdir"/usr/bin/testpattern "$subpkgdir"/usr/bin/ || return 1

}

sha512sums="aeb06b4be45fcb67320b419b988ca59dbda51bb2c3ff4edd0f0757ac977565a6829f506ebea6872211c689a15925ad2119836424c3c9a97345a8cd506e9df9fd  gutenprint-5.2.14.tar.bz2
f9cc73eb3666184b4829f9ee30c3fa04cb5c3fae26c268f5db3b3e8eef21c529a97400aa551c3a88d2f3f25612623002da0e1b52e74b74b56223395cb69d5933  musl-fix-header.patch
8b17b4d3dd3f9dbeff7c3a3da38395cde8bea51abe5a8ebeac62b9e442dc451341b3571de02437d035a63da83d10316a4ce0da143cc90a935678a01fb5efb224  pagesize-name-clash.patch
10fcd9934f7d4ff8fe61f835338ded1f96aaf7147a3c1b50124e57165e8d52da53fc3f9c44190c6059123d0bf9004fbbd246a782b10f51269396ef7ca6585091  gutenprint-O6.patch"
